<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Productos e Inventario</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="../static/css/shared_theme.css">
    <link rel="stylesheet" href="../static/css/product_management.css">
</head>
<body>
    <div id="user-id-indicator" style="position: fixed; top: 10px; left: 10px; background-color: #f0f0f0; padding: 5px; border: 1px solid #ccc; z-index: 1000;"></div>
    <div class="container">
        <header>
            <div class="menu-icon">☰</div>
            <h1>Gestión de Productos e Inventario</h1>
            <nav class="dropdown-menu">
                <a href="product_management.html">Gestión de Productos e Inventario</a>
                <a href="configuracion.html">Configuración</a>
                <a href="proceso_venta_caja.html">Proceso de Venta y Caja</a>
                <a href="gestion_clientes.html">Gestión de Clientes</a>
                <a href="informes_analiticas.html">Informes y Analíticas</a>
                <a href="index.html">Inicio</a>
                <a href="#" onclick="logout()">Cerrar Sesión</a>
            </nav>
        </header>
        <main>
            <h1>Gestión de Productos e Inventario</h1>

            <button id="btnNuevoProducto">Nuevo Producto</button>
            <input type="text" id="inputBuscarProducto" placeholder="Buscar producto...">

            <div id="filtrosAvanzados" class="filtros-avanzados">
                <select id="filtroCategoria">
                    <option value="">Todas las categorías</option>
                    <!-- Opciones de categoría se cargarán aquí -->
                </select>
                <select id="filtroProveedor">
                    <option value="">Todos los proveedores</option>
                    <!-- Opciones de proveedor se cargarán aquí -->
                </select>
                <select id="filtroEstado">
                    <option value="">Todos (Activos por defecto)</option>
                    <option value="true">Activo</option>
                    <option value="false">Inactivo</option>
                    <option value="all">Todos (Incluir Inactivos)</option> 
                </select>
                <button id="btnAplicarFiltros">Aplicar Filtros</button>
                <button id="btnLimpiarFiltros">Limpiar Filtros</button>
            </div>

            <table id="tablaProductos">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>SKU</th>
                        <th>Nombre</th>
                        <th>Precio Venta</th>
                        <th>Stock Actual</th>
                        <th>Stock Mín.</th>
                        <th>Cód. Barras</th>
                        <th>Unidad Med.</th>
                        <th>Permite Dec.</th>
                        <th>Categoría</th>
                        <th>Proveedor</th>
                        <th>Acciones Fijas</th>
                    </tr>
                </thead>
                <tbody id="tbodyProductos">
                    <!-- Los datos de los productos se cargarán aquí dinámicamente -->
                </tbody>
            </table>

            <div id="controlesPaginacion" class="pagination-controls">
                <!-- Los controles de paginación se generarán aquí -->
            </div>

            <!-- Modal para Crear/Editar Producto -->
            <div id="modalProducto" class="modal" style="display:none;">
                <div class="modal-content">
                    <span class="close-button" onclick="document.getElementById('modalProducto').style.display='none'">&times;</span>
                    <h2 id="modalTitle">Crear/Editar Producto</h2>
                    <form id="formProducto">
                        <input type="hidden" id="productId">
                        <div>
                            <label for="productSku">SKU:</label>
                            <input type="text" id="productSku" name="sku">
                            <span id="error-productSku" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productName">Nombre:</label>
                            <input type="text" id="productName" name="name" required>
                            <span id="error-productName" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productDescription">Descripción:</label>
                            <textarea id="productDescription" name="description"></textarea>
                            <span id="error-productDescription" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productPriceBuy">Precio Compra:</label>
                            <input type="number" id="productPriceBuy" name="price_buy" step="0.01">
                            <span id="error-productPriceBuy" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productPriceSell">Precio Venta:</label>
                            <input type="number" id="productPriceSell" name="price_sell" step="0.01" required>
                            <span id="error-productPriceSell" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productStock">Stock Inicial:</label>
                            <input type="number" id="productStock" name="stock_quantity" required>
                            <span id="error-productStock" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productCategory">Categoría:</label>
                            <select id="productCategory" name="category_id">
                                <!-- Opciones de categoría se cargarán aquí -->
                            </select>
                            <span id="error-productCategory" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productSupplier">Proveedor:</label>
                            <select id="productSupplier" name="supplier_id">
                                <!-- Opciones de proveedor se cargarán aquí -->
                            </select>
                            <span id="error-productSupplier" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productMinStock">Stock Mínimo:</label>
                            <input type="number" id="productMinStock" name="min_stock_level" step="1">
                            <span id="error-productMinStock" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productBarcode">Código de Barras:</label>
                            <input type="text" id="productBarcode" name="barcode">
                            <span id="error-productBarcode" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productUnitOfMeasure">Unidad de Medida:</label>
                            <input type="text" id="productUnitOfMeasure" name="unit_of_measure" placeholder="Ej: unidad, kg, litro">
                            <span id="error-productUnitOfMeasure" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productAllowDecimalQuantities">Permitir Cantidades Decimales:</label>
                            <input type="checkbox" id="productAllowDecimalQuantities" name="allow_decimal_quantities">
                            <span id="error-productAllowDecimalQuantities" class="error-message"></span>
                        </div>
                        <div>
                            <label for="productIsActive">Activo:</label>
                            <input type="checkbox" id="productIsActive" name="is_active" checked>
                            <span id="error-productIsActive" class="error-message"></span>
                        </div>
                        <button type="submit">Guardar Producto</button>
                        <button type="button" onclick="document.getElementById('modalProducto').style.display='none'">Cancelar</button>
                        <div id="error-formProducto" class="error-message"></div>
                    </form>
                </div>
            </div>

            <!-- Modal para Ajustar Stock -->
            <div id="modalAjusteStock" class="modal" style="display:none;">
                <div class="modal-content">
                    <span class="close-button" onclick="document.getElementById('modalAjusteStock').style.display='none'">&times;</span>
                    <h2>Ajustar Stock</h2>
                    <form id="formAjusteStock">
                        <input type="hidden" id="ajusteProductoId">
                        <div>
                            <p>Producto: <span id="ajusteNombreProducto"></span></p>
                        </div>
                        <div>
                            <label for="ajusteCantidad">Cantidad a Ajustar:</label>
                            <input type="number" id="ajusteCantidad" name="quantity" required>
                            <div id="infoDecimalesAjuste" class="info-message" style="font-size: 0.9em; color: #555; margin-top: 5px;"></div>
                        </div>
                        <div>
                            <label for="ajusteMotivo">Motivo:</label>
                            <input type="text" id="ajusteMotivo" name="notes">
                        </div>
                        <div>
                            <label for="ajusteTipoMovimiento">Tipo de Movimiento:</label>
                            <select id="ajusteTipoMovimiento" name="movement_type" required>
                                <option value="compra">Compra</option>
                                <option value="venta">Venta (manual)</option>
                                <option value="ajuste">Ajuste</option>
                            </select>
                        </div>
                        <button type="submit">Realizar Ajuste</button>
                        <button type="button" onclick="document.getElementById('modalAjusteStock').style.display='none'">Cancelar</button>
                    </form>
                </div>
            </div>

            <!-- Gestión de Categorías -->
            <section id="gestionCategorias">
                <h3>Gestión de Categorías</h3>
                <form id="formCategoria">
                    <input type="hidden" id="categoriaId">
                    <div>
                        <label for="categoriaNombre">Nombre:</label>
                        <input type="text" id="categoriaNombre" name="name" required>
                    </div>
                    <button type="submit" id="btnGuardarCategoria">Guardar Categoría</button>
                </form>
                <ul id="listaCategorias">
                    <!-- Las categorías se listarán aquí -->
                </ul>
            </section>

            <!-- Gestión de Proveedores -->
            <section id="gestionProveedores">
                <h3>Gestión de Proveedores</h3>
                <form id="formProveedor">
                    <input type="hidden" id="proveedorId">
                    <div>
                        <label for="proveedorNombre">Nombre:</label>
                        <input type="text" id="proveedorNombre" name="name" required>
                    </div>
                    <div>
                        <label for="proveedorContacto">Contacto:</label>
                        <input type="text" id="proveedorContacto" name="contact_info">
                    </div>
                    <button type="submit" id="btnGuardarProveedor">Guardar Proveedor</button>
                </form>
                <ul id="listaProveedores">
                    <!-- Los proveedores se listarán aquí -->
                </ul>
            </section>

            <section id="alertasStockBajo">
                <h3>Alertas de Stock Bajo</h3>
                <ul id="listaAlertasStock">
                    <!-- Las alertas de stock bajo se mostrarán aquí -->
                </ul>
            </section>

            <!-- Modal de Detalle de Producto -->
            <div id="modalDetalleProducto" class="modal" style="display:none;">
                <div class="modal-content large">
                    <span class="close-button" onclick="document.getElementById('modalDetalleProducto').style.display='none'">&times;</span>
                    <h2>Detalle del Producto</h2>
                    <div id="detalleProductoInfo">
                        <!-- Información detallada del producto se cargará aquí -->
                    </div>
                    <h3>Historial de Movimientos</h3>
                    <table id="tablaHistorialMovimientos">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Cantidad</th>
                                <th>Usuario</th>
                                <th>Notas</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyHistorialMovimientos">
                            <!-- Historial de movimientos se cargará aquí -->
                        </tbody>
                    </table>
                </div>
            </div>

        </main>
    </div>

    <script src="../static/js/shared_menu.js"></script>
    <script src="../static/js/auth_check.js"></script>
    <script src="../static/js/product_management.js"></script>
</body>
</html>